{% extends "mobile/base.html" %}

{% block title %}Inicio - SGA Móvil{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Gestión rápida de activos{% endblock %}

{% block content %}
<div class="mb-3">
    <input type="text" class="form-control" placeholder="Buscar activo por código..." id="quickSearch">
</div>

<div class="row g-3 mb-4">
    <div class="col-6">
        <div class="card-mobile text-center">
            <div class="card-body">
                <i class="bi bi-box text-primary" style="font-size: 2rem;"></i>
                <h5 class="mt-2 mb-1" id="totalActivos">-</h5>
                <small class="text-muted">Total Activos</small>
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="card-mobile text-center">
            <div class="card-body">
                <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
                <h5 class="mt-2 mb-1" id="alertasActivos">-</h5>
                <small class="text-muted">Alertas</small>
            </div>
        </div>
    </div>
</div>

<h6 class="mb-3">Acciones Rápidas</h6>
<div class="row g-3 mb-4">
    <div class="col-4">
        <div class="text-center p-3 card-mobile" onclick="irAEscanear()">
            <i class="bi bi-qr-code-scan text-primary" style="font-size: 2rem;"></i>
            <div class="small mt-2">Escanear QR</div>
        </div>
    </div>
    <div class="col-4">
        <div class="text-center p-3 card-mobile" onclick="nuevaAuditoria()">
            <i class="bi bi-clipboard-check text-success" style="font-size: 2rem;"></i>
            <div class="small mt-2">Auditoría</div>
        </div>
    </div>
    <div class="col-4">
        <div class="text-center p-3 card-mobile" onclick="reporteRapido()">
            <i class="bi bi-flag text-info" style="font-size: 2rem;"></i>
            <div class="small mt-2">Reportar</div>
        </div>
    </div>
</div>

<h6 class="mb-3">Actividad Reciente</h6>
<div id="actividadReciente">
    <div class="text-center py-4">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="mt-2">Cargando actividad...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    cargarDashboardMovil();
});

async function cargarDashboardMovil() {
    try {
        const response = await fetch('/api/reportes/dashboard');
        const data = await response.json();
        
        document.getElementById('totalActivos').textContent = data.total_activos;
        document.getElementById('alertasActivos').textContent = data.activos_sin_ubicacion;
        
        cargarActividadReciente();
        
    } catch (error) {
        console.error('Error cargando dashboard:', error);
    }
}

function cargarActividadReciente() {
    const container = document.getElementById('actividadReciente');
    container.innerHTML = `
        <div class="card-mobile">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-info-circle text-primary me-3"></i>
                    <div>
                        <div class="small">Sistema inicializado correctamente</div>
                        <small class="text-muted">Hace unos momentos</small>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function irAEscanear() {
    window.location.href = '/mobile/scan';
}

function nuevaAuditoria() {
    alert('Función de auditoría próximamente');
}

function reporteRapido() {
    alert('Función de reporte próximamente');
}
</script>
{% endblock %}
